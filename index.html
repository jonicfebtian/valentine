<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>For Hana ü§ç</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif}

body{
  background:radial-gradient(circle at top,#1a0033,#05000d 80%);
  color:white;
  overflow:hidden;
}

canvas{position:fixed;inset:0;z-index:0}

/* Confetti Canvas */
#confetti{
  position:fixed;
  inset:0;
  z-index:9996;
  pointer-events:none;
  display:none;
}

.wrapper{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
  position:relative;
  z-index:2;
}

.card{
  background:rgba(255,255,255,.07);
  backdrop-filter:blur(18px);
  border-radius:26px;
  padding:26px 24px;
  max-width:380px;
  width:100%;
  text-align:center;
  box-shadow:0 0 60px rgba(170,120,255,.28);
  animation:fadeUp 1.2s ease;
  max-height:90vh;
  overflow-y:auto;
}

@keyframes fadeUp{
  from{opacity:0;transform:translateY(30px)}
  to{opacity:1;transform:translateY(0)}
}

h1{
  font-family:'Playfair Display',serif;
  font-weight:600;
  margin-bottom:12px;
}

p{
  line-height:1.75;
  font-size:15px;
}

button{
  margin-top:18px;
  padding:12px 28px;
  border:none;
  border-radius:30px;
  background:linear-gradient(135deg,#ff9dd5,#b47cff,#6f9cff);
  color:#fff;
  font-weight:600;
  cursor:pointer;
  box-shadow:0 0 25px rgba(180,120,255,.45);
  transition:.3s;
}
button:hover{transform:scale(1.05)}
.hide{display:none}

/* Video */
.video-box{
  margin:14px 0 18px;
  border-radius:18px;
  overflow:hidden;
  height:260px;
  background:#000;
}
.video-box video{
  width:100%;
  height:100%;
  object-fit:cover;
}

/* Typing */
#typing{
  margin-top:12px;
  white-space:pre-line;
}

/* Game */
#gameWrap{
  margin-top:18px;
  padding:14px;
  border-radius:18px;
  background:rgba(255,255,255,.06);
}

.choice-row{
  display:flex;
  gap:10px;
  justify-content:center;
  margin:10px 0;
}

.pill{
  padding:8px 14px;
  border-radius:999px;
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.2);
  cursor:pointer;
}
.pill.active{
  background:rgba(255,255,255,.18);
}

.board{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:8px;
  margin-top:10px;
}

.cell{
  aspect-ratio:1/1;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:30px;
  font-weight:bold;
  border-radius:12px;
  background:rgba(255,255,255,.08);
  cursor:pointer;
}
.cell.disabled{opacity:.6;cursor:not-allowed}

/* Modal */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  backdrop-filter:blur(6px);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9997;
}

.modal.show{display:flex}

.modal-card{
  background:rgba(255,255,255,.1);
  padding:16px;
  border-radius:20px;
  width:min(400px,90%);
  position:relative;
  text-align:center;
}

.modal-img{
  width:100%;
  border-radius:16px;
}

.close-btn{
  position:absolute;
  top:8px;
  right:8px;
  background:rgba(255,255,255,.15);
  border:none;
  width:36px;
  height:36px;
  border-radius:50%;
  cursor:pointer;
  font-weight:bold;
}

.modal-title{
  margin-top:10px;
  font-size:14px;
}
</style>
</head>

<body>
<canvas id="lux"></canvas>
<canvas id="confetti"></canvas>

<!-- Reward Popup -->
<div class="modal" id="rewardModal">
  <div class="modal-card">
    <button class="close-btn" onclick="closeReward()">√ó</button>
    <img src="image2.png" class="modal-img">
    <div class="modal-title">
      Totally worth it, I get to celebrate my valentine ü§ç
    </div>
  </div>
</div>

<div class="wrapper">

<div class="card" id="openCard">
  <h1>Hi Hana ü§ç</h1>
  <p>I made something small for you ‚ú®</p>
  <button onclick="openMsg()">Open Message</button>
</div>

<div class="card hide" id="msgCard">
  <h1>Happy Valentine ü§ç</h1>

  <div class="video-box">
    <video autoplay loop muted playsinline>
      <source src="hana.mp4" type="video/mp4">
    </video>
  </div>

  <p id="typing"></p>

  <button id="playBtn" class="hide" onclick="showGame()">Play Tic Tac Toe ü§ç</button>

  <div id="gameWrap" class="hide">
    <div id="legend">Pick X or O ü§ç</div>

    <div class="choice-row">
      <div class="pill active" id="pickX" onclick="pickSide('X')">X</div>
      <div class="pill" id="pickO" onclick="pickSide('O')">O</div>
    </div>

    <div class="board" id="board"></div>
    <div id="gameStatus"></div>
  </div>
</div>

<audio id="music" loop>
  <source src="music.mp3" type="audio/mpeg">
</audio>

</div>

<script>
function openMsg(){
  openCard.classList.add("hide");
  msgCard.classList.remove("hide");
  music.play().catch(()=>{});
  i=0;
  typing.innerHTML="";
  typeWriter();
}

const text=`This is just a simple message ü§ç`;
let i=0;
function typeWriter(){
  if(i<text.length){
    typing.innerHTML+=text.charAt(i);
    i++;
    setTimeout(typeWriter,40);
  }else{
    playBtn.classList.remove("hide");
  }
}

/* GAME */
let boardArr, player="X", robot="O", playerTurn=true, gameOver=false;
const ROBOT_MISTAKE_RATE=0.65;

function showGame(){
  gameWrap.classList.remove("hide");
  resetGame();
}

function pickSide(s){
  player=s;
  robot=s==="X"?"O":"X";
  pickX.classList.toggle("active",player==="X");
  pickO.classList.toggle("active",player==="O");
  resetGame();
}

function resetGame(){
  boardArr=Array(9).fill(null);
  gameOver=false;
  playerTurn=player==="X";
  render();
  if(!playerTurn)setTimeout(robotMove,400);
}

function render(){
  board.innerHTML="";
  boardArr.forEach((v,i)=>{
    let d=document.createElement("div");
    d.className="cell"+(v||!playerTurn||gameOver?" disabled":"");
    d.innerText=v||"";
    d.onclick=()=>move(i);
    board.appendChild(d);
  });
}

function move(i){
  if(boardArr[i]||!playerTurn||gameOver)return;
  boardArr[i]=player;
  playerTurn=false;
  check();
  render();
  if(!gameOver)setTimeout(robotMove,300);
}

function robotMove(){
  if(gameOver)return;
  let empty=boardArr.map((v,i)=>v?null:i).filter(v=>v!==null);
  let moveIndex;
  if(Math.random()<ROBOT_MISTAKE_RATE){
    moveIndex=empty[Math.floor(Math.random()*empty.length)];
  }else{
    moveIndex=empty[Math.floor(Math.random()*empty.length)];
  }
  boardArr[moveIndex]=robot;
  playerTurn=true;
  check();
  render();
}

function check(){
  const wins=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
  for(let [a,b,c] of wins){
    if(boardArr[a]&&boardArr[a]===boardArr[b]&&boardArr[a]===boardArr[c]){
      gameOver=true;
      if(boardArr[a]===player){
        startConfetti();
        rewardModal.classList.add("show");
      }
    }
  }
}

/* Confetti */
const confetti=document.getElementById("confetti");
const ctx2=confetti.getContext("2d");
let pieces=[];
function startConfetti(){
  confetti.width=innerWidth;
  confetti.height=innerHeight;
  confetti.style.display="block";
  pieces=Array.from({length:150},()=>({
    x:Math.random()*confetti.width,
    y:Math.random()*confetti.height-confetti.height,
    r:Math.random()*6+4,
    d:Math.random()*50
  }));
  setTimeout(()=>confetti.style.display="none",2000);
  animate();
}
function animate(){
  ctx2.clearRect(0,0,confetti.width,confetti.height);
  ctx2.fillStyle="rgba(255,180,255,.9)";
  pieces.forEach(p=>{
    ctx2.beginPath();
    ctx2.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx2.fill();
    p.y+=3;
    if(p.y>confetti.height)p.y=0;
  });
  requestAnimationFrame(animate);
}

function closeReward(){
  rewardModal.classList.remove("show");
}

/* Background stars */
const c=document.getElementById("lux");
const ctx=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight}
resize();onresize=resize;
let stars=Array.from({length:120},()=>({
  x:Math.random()*c.width,
  y:Math.random()*c.height,
  r:Math.random()*1.5
}));
function draw(){
  ctx.clearRect(0,0,c.width,c.height);
  ctx.fillStyle="rgba(200,160,255,.7)";
  stars.forEach(s=>{
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fill();
  });
  requestAnimationFrame(draw);
}
draw();
</script>
</body>
</html>
